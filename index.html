<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Editable WBG Report Table</title>
<style>
  body { background: #fff; }
  table {
    border-collapse: collapse;
    text-align: center;
    font-family: Arial, sans-serif;
    font-size: 12px;
  }
  th, td {
    border: 2px solid #000;
    padding: 3px 6px;
  }

  .title { background: #d9ead3; font-weight: bold; font-size: 13px; text-align: center; color: black; }
  .team { background: #92d050; }
  .tco, .mytel, .site, .status, .dg { background: #92d050; font-weight: bold; }
  .subhead { background: #92d050; font-weight: bold; }
  .total { background: #92d050; font-weight: bold; }

  .group-status { background: red; color: yellow; }
  .group-status-a { background: yellow; }
  .group-status-b { background: #b4c6e7; }
  .group-dg { background: yellow; color: red; }
  .group-dg-a { background: #ffc000; }

  .t1 { background: orange; color: white; }
  .t2 { background: #ddebf7; }
  .t3 { background: rgb(229, 229, 120); }
  .t4 { background: #e2efda; }
  .t5 { background: #f8cbad; }
  .t6 { background: #d6dce4; }
  .t7 { background: #d6dce4; color: red; }

  .header-bar {
    background: #92d050;
    text-align: center;
    font-weight: bold;
    border: 2px solid #000;
    padding: 6px;
  }

  #controls {
    font-family: Arial;
    font-size: 13px;
    margin: 12px 0;
    background: #f3f3f3;
    padding: 8px;
    border-radius: 8px;
  }

  input, select {
    padding: 5px;
    font-size: 12px;
  }

  button {
    background: #4CAF50;
    color: white;
    border: none;
    padding: 6px 10px;
    border-radius: 6px;
    cursor: pointer;
  }
  button:hover {
    background: #45a049;
  }
</style>
</head>
<body>

<!-- ===== TABLE ===== -->
<div id="tableArea" style="display:inline-block; background:white; padding:10px;">
<table>
  <tr>
    <th colspan="25" class="header-bar" id="time">--:--:---- --:--:--</th>
  </tr>

  <tr class="title">
    <th rowspan="1" class="team">Team</th>
    <th colspan="2" class="tco">TCO</th>
    <th colspan="2" class="mytel">MYTEL</th>
    <th colspan="2" class="mytel">Total</th>
    <th colspan="2" class="site">Site</th>
    <th colspan="13" class="status">Site down status</th>
    <th colspan="3" class="dg">DG</th>
  </tr>

  <tr class="subhead">
    <th rowspan="2"></th>
    <th rowspan="1">AC Main Fails_TowerCo.</th>
    <th rowspan="1">Low alarm_TowerCo.</th>
    <th rowspan="1">Mains Failure</th>
    <th rowspan="1">DC Voltage Low</th>
    <th rowspan="1">Sites Grid cut</th>
    <th rowspan="1">DC Low alarm</th>
    <th rowspan="1">Total site</th>
    <th rowspan="1">Site Grid only</th>
    <th colspan="3" class="group-status">Total Site down</th>
    <th colspan="6" class="group-status-a">Down time remain</th>
    <th rowspan="1" class="group-status">SRT+ OLT down</th>
    <th colspan="3" class="group-status-b">Prioritize</th>
    <th rowspan="1" class="group-dg">Alarm &gt;24h + DG.Stop</th>
    <th rowspan="1" class="group-dg">DG Manual Mode</th>
    <th rowspan="1" class="group-dg-a">DG.Abnormal Alarm</th>
  </tr>

  <tr class="subhead">
    <th></th>
    <th></th>
    <th></th>
    <th></th>
    <th></th>
    <th></th>
    <th></th>
    <th></th>
    <th>Total</th>
    <th>Mytel</th>
    <th>TCo</th>
    <th>&lt;=4h</th>
    <th>&gt;4h-8h</th>
    <th>&gt;8-12h</th>
    <th>&gt;12-16h</th>
    <th>&gt;16-24h</th>
    <th>&gt;24h</th>
    <th></th>
    <th>Priority 1</th>
    <th>Priority 2</th>
    <th>Priority 3</th>
    <th></th>
    <th></th>
    <th></th>
  </tr>

  <tr>
    <td>MYT_WBG_TEAM01</td><td class="t1">21</td><td class="t1">5</td><td class="t2">11</td><td class="t2">1</td><td class="t3">32</td><td class="t3">6</td><td class="t4">105</td><td class="t4">6</td><td class="t5">1</td><td class="t5">1</td><td class="t5">0</td><td class="t6">1</td><td class="t6">0</td><td class="t6">0</td><td class="t6">0</td><td class="t6">0</td><td class="t6">0</td><td class="t5">1</td><td class="t3">1</td><td class="t3">0</td><td class="t3">0</td><td class="t5">0</td><td class="t5">0</td><td class="t7">1</td>
  </tr>
  <tr>
    <td>MYT_WBG_TEAM02</td><td class="t1">13</td><td class="t1">3</td><td class="t2">15</td><td class="t2">1</td><td class="t3">28</td><td class="t3">4</td><td class="t4">94</td><td class="t4">9</td><td class="t5">2</td><td class="t5">1</td><td class="t5">1</td><td class="t6">0</td><td class="t6">0</td><td class="t6">0</td><td class="t6">0</td><td class="t6">0</td><td class="t6">2</td><td class="t5">0</td><td class="t3">0</td><td class="t3">0</td><td class="t3">2</td><td class="t5">0</td><td class="t5">0</td><td class="t7">4</td>
  </tr>
  <tr>
    <td>MYT_WBG_TEAM03</td><td class="t1">22</td><td class="t1">12</td><td class="t2">3</td><td class="t2">0</td><td class="t3">25</td><td class="t3">12</td><td class="t4">110</td><td class="t4">9</td><td class="t5">4</td><td class="t5">0</td><td class="t5">4</td><td class="t6">2</td><td class="t6">0</td><td class="t6">0</td><td class="t6">0</td><td class="t6">0</td><td class="t6">2</td><td class="t5">0</td><td class="t3">0</td><td class="t3">2</td><td class="t3">2</td><td class="t5">0</td><td class="t5">0</td><td class="t7">0</td>
  </tr>
  <tr>
    <td>MYT_WBG_TEAM04</td><td class="t1">22</td><td class="t1">3</td><td class="t2">14</td><td class="t2">0</td><td class="t3">36</td><td class="t3">3</td><td class="t4">85</td><td class="t4">2</td><td class="t5">0</td><td class="t5">0</td><td class="t5">0</td><td class="t6">0</td><td class="t6">0</td><td class="t6">0</td><td class="t6">0</td><td class="t6">0</td><td class="t6">0</td><td class="t5">0</td><td class="t3">0</td><td class="t3">0</td><td class="t3">0</td><td class="t5">0</td><td class="t5">0</td><td class="t7">0</td>
  </tr>
  <tr class="total">
    <td>WBG</td><td>78</td><td>23</td><td>43</td><td>2</td><td>121</td><td>25</td><td>394</td><td>26</td><td>7</td><td>2</td><td>5</td><td>3</td><td>0</td><td>0</td><td>0</td><td>0</td><td>4</td><td>1</td><td>1</td><td>2</td><td>4</td><td>0</td><td>0</td><td>5</td>
  </tr>
</table>
</div>

<!-- ===== CONTROL SECTION ===== -->
<div id="controls">
  <label>Team:</label>
  <select id="teamSelect">
    <option value="1">MYT_WBG_TEAM01</option>
    <option value="2">MYT_WBG_TEAM02</option>
    <option value="3">MYT_WBG_TEAM03</option>
    <option value="4">MYT_WBG_TEAM04</option>
  </select>
  <label>Column (2â€“25):</label>
  <input type="number" id="colIndex" min="2" max="25" value="2" style="width:60px;">
  <label>New Value:</label>
  <input type="text" id="newValue" style="width:100px;">
  <button onclick="editCell()">Apply</button>
  <button onclick="saveAsImage()">Save as Image</button>
  <button onclick="switchToLandscape()">ðŸ“± Landscape Mode</button>

</div>

<!-- ===== JS ===== -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
function updateDateTime() {
  const now = new Date();
  const formatted = now.toLocaleString('en-GB');
  document.getElementById("time").textContent =
    "WBG Report Site down, Exported Time : " + formatted + " (date format: dd/MM/yyyy HH:mm:ss)";
}
setInterval(updateDateTime, 1000);
updateDateTime();

function editCell() {
  const teamRow = parseInt(document.getElementById("teamSelect").value);
  const col = parseInt(document.getElementById("colIndex").value);
  const newValue = document.getElementById("newValue").value.trim();
  if (!newValue) return alert("Enter value.");

  const table = document.querySelector("table");
  const row = table.rows[teamRow + 3];
  if (row && row.cells[col - 1]) {
    row.cells[col - 1].textContent = newValue;
    
  } else {
    alert("Invalid column number!");
  }
}

/**
 * Inline all computed styles for node and its children so the clone
 * looks exactly like the rendered element even when drawn off-screen.
 */
function inlineAllStyles(node) {
  const walk = (el) => {
    if (el.nodeType !== 1) return; // skip non-elements
    const computed = window.getComputedStyle(el);
    let cssText = "";
    for (let i = 0; i < computed.length; i++) {
      const prop = computed[i];
      cssText += `${prop}: ${computed.getPropertyValue(prop)}; `;
    }
    // Set style attribute to computed CSS
    el.setAttribute("style", cssText);
    // Recurse
    for (let i = 0; i < el.children.length; i++) {
      walk(el.children[i]);
    }
  };
  walk(node);
}

function saveAsImage() {
  const element = document.getElementById("tableArea");

  // temporarily clone the table to flatten rowspan/colspan rendering
  const clone = element.cloneNode(true);
  clone.style.transform = "scale(1)";
  clone.style.position = "absolute";
  clone.style.left = "-9999px";
  document.body.appendChild(clone);

  html2canvas(clone, {
    scale: 3,
    backgroundColor: "#ffffff",
    useCORS: true,
    logging: false,
    allowTaint: true,
    windowWidth: document.body.scrollWidth,
    scrollX: 0,
    scrollY: 0
  }).then(canvas => {
    const link = document.createElement("a");
    const timestamp = new Date().toISOString().replace(/[:.]/g, "-");
    link.download = `WBG_Report_${timestamp}.png`;
    link.href = canvas.toDataURL("image/png");
    link.click();
    clone.remove();
  }).catch(err => {
    alert("Error saving image: " + err);
  });
}

async function switchToLandscape() {
  if (screen.orientation && screen.orientation.lock) {
    try {
      await screen.orientation.lock("landscape");
      alert("Switched to landscape mode âœ…");
    } catch (err) {
      alert("Your browser doesnâ€™t allow automatic rotation.\nPlease rotate your phone manually ðŸ“²");
    }
  } else {
    alert("Landscape mode lock not supported on this device.\nTry rotating your phone manually ðŸ“²");
  }
}

</script>

</body>
</html>
